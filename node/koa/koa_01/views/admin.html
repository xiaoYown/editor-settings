<!DOCTYPE html>
<html lang="zh_CN">
	<head>
		<meta charset="utf-8">
		<title>用户管理</title>
		<link rel="stylesheet" href="/static/css/reset.css">
		<link rel="stylesheet" href="/static/css/admin.css">
		<link rel="stylesheet" href="/static/css/editormd.css">
		<link rel="stylesheet" href="/static/css/codemirror.css">
	</head>
	<body>
		<div class="admin-content">
			<!-- 侧边栏 -->
			<div class="admin-sidebar">
				<ul class="admin-navigate">
					<li>
						<a href="#/" class="admin-navigate-item">主页</a>
					</li>
					<li>
						<a href="#/blog" class="admin-navigate-item">博客</a>
					</li>
					<li>
						<a href="#/dynamic" class="admin-navigate-item">动态</a>
					</li>
					<li>
						<a href="#/attribute" class="admin-navigate-item">属性</a>
					</li>
					<li>
						<a href="/">首页</a>
					</li>
				</ul>
			</div>
			<!-- 视口 -->
			<ul class="admin-section">
				<!-- 主页 -->
				<li class="admin-section-item" view-port="/">
					主页
				</li>
				<!-- 博客 -->
				<li class="admin-section-item" view-port="/blog">
					<div class="blog-header">
					</div>

					<div class="blog-section">
						<!-- <ul id="blog-list"></ul> -->
						<table class="artical-list-wrap">
							<thead>
								<tr>
									<th>名称</th>
									<th>一级分类</th>
									<th>二级分类</th>
									<th>三级分类</th>
									<th>创建时间</th>
									<th>更新时间</th>
									<th>操作</th>
								</tr>
							</thead>
							<tbody id="blog-list"></tbody>
						</table>
					</div>
					<div class="blog-footer">
						<a href="#/edit">新增</a>
					</div>
				</li>
				<!--  动态  -->
				<li class="admin-section-item" view-port="/dynamic">
					动态
				</li>
				<!-- 属性 -->
				<li class="admin-section-item" view-port="/attribute">
					属性
				</li>

				<li class="admin-section-item" view-port="/edit">
					<div class="edit-section">
						<div id="test-editormd"></div>
					</div>
					<div class="edit-footer">
						<select name="" id="type_NO01">
							<option value="">请选择</option>
							<option value="blog">博客</option>
						</select>
						<select name="" id="type_NO02">
							<option value="">请选择</option>
							<option value="web_front_end">前端</option>
						</select>
						<select name="" id="type_NO03">
							<option value="">请选择</option>
							<option value="framework">框架</option>
						</select>
                        <input type="text" id="add-title" style="border: 1px solid #000;">
						<button id="add-post">提交</button>
					</div>
					<div id="show"></div>
				</li>

			</ul>

		</div>
	</body>
</html>
<script src="/static/js/jquery.js"></script>
<script src="/static/js/editormd.js"></script>
<script src="/static/js/codemirror.js"></script>
<script src="/static/js/modes.min.js"></script>
<script src="/static/js/addons.min.js"></script>
<script src="/static/js/marked.min.js"></script>
<script src="/static/js/prettify.min.js"></script>

<script src="/static/js/underscore.min.js"></script>
<script src="/static/js/raphael.min.js"></script>
<script src="/static/js/sequence-diagram.min.js"></script>
<script src="/static/js/flowchart.min.js"></script>
<script src="/static/js/jquery.flowchart.min.js"></script>

<script>
	// editor 
	var editor = null;
	// router
	var router = [
		{
			path: '/',
			cb: 'index'
		},{
			path: '/edit',
			cb: 'edit'
		},{
			path: '/blog',
			cb: 'blog'
		}
	];
	var views = {
		index: function(){

		},
		edit: function(){
			if( !editor ){
				editor = editormd("test-editormd", {
					width   : "90%",
					height  : 640,
					syncScrolling : "single",
					path    : "../static/js/"
				});
			}

		},
		blog: function(){
			$.ajax({
				url: '/artical_list/blog',
	            type: 'GET',
	            dataType: 'JSON',
	            data: {},
	            success: function(res){
	                if( res.code == '000000' ){
						var artical_list = res.data;
						var list = '';
						for( var i = 0, len = artical_list.length; i < len; i++ ){
							list += '<tr>' +
								'<td>' + artical_list[i].title + '</td>' +
								'<td>' + artical_list[i].type_name_NO01 + '</td>' +
								'<td>' + artical_list[i].type_name_NO02 + '</td>' +
								'<td>' + artical_list[i].type_name_NO03 + '</td>' +
								'<td>' + artical_list[i].create_time + '</td>' +
								'<td>' + artical_list[i].update_time + '</td>' +
								'<td><span blog-put="' + artical_list[i].id + '">编辑</span><span blog-del=' + artical_list[i].id + ' >删除</span></td>' +
								'</tr>';
						}
						document.getElementById('blog-list').innerHTML = list;

						//删除
						var dels = document.querySelectorAll('[blog-del]');

						for( var i = 0, len = dels.length; i < len; i++ ){
							dels[i].onclick = del;
						}
	                }
	            },
	            error: function(status){
	                console.log(status)
	            }
			});
		}
	};
	// viewport change
	function viewChange(){
		var path = location.hash.substring(1);
		let view_ports = document.querySelectorAll('li[view-port]');
		
		if( !path ){
			path = '/';
		}

		for( var i = 0, len = view_ports.length; i < len; i++ ){
			if( path == view_ports[i].getAttribute('view-port') ){
				view_ports[i].style.display = 'block';
			} else {
				view_ports[i].style.display = 'none';
			}
		}
		for( var i = 0, len = router.length; i < len; i++ ){
			if( router[i].path == path ){
				if( path !== '/' ){
					views[path.substring(1)]();
				} else {
					views.index();
				}
				break;
			}
		}
	}

	window.addEventListener('hashchange', viewChange);

	viewChange();

	/* 操作 */
	// del
	function del(){
		var _this = this;
		var data = {
			id: this.getAttribute('blog-del')
		};
		$.ajax({
			url: '/artical/del',
			type: 'POST',
			dataType: 'JSON',
			data: data,
			success: function(res){
				console.log(res)
				var tr = _this.parentNode.parentNode;
				tr.parentNode.removeChild(tr);
			},
			error: function(){

			}
		});
	}
	// add
	function submit(){
		var type_NO01 = document.getElementById('type_NO01').value,
			type_NO02 = document.getElementById('type_NO02').value,
			type_NO03 = document.getElementById('type_NO03').value,
			title     = document.getElementById('add-title').value;

		if( !type_NO01 || !type_NO02 || !type_NO03 || !title) {
			console.log('请将信息输入完整');
			return
		}
		var data = {
			type_NO01: type_NO01,
			type_NO02: type_NO02,
			type_NO03: type_NO03,
            title: title,
			content:   editor.getMarkdown(),
		};

		$.ajax({
            url: '/artical/add',
            type: 'POST',
            dataType: 'JSON',
            data: data,
            success: function(res){
                if( res.code == '000000' ){
					console.log(res)
                }
            },
            error: function(status){
                console.log(status)
            }
        });

	}
	document.getElementById('add-post').addEventListener('click', submit);

</script>